---
description:
globs:
alwaysApply: false
---
# Pre-commit Checklist

## ğŸ“‹ **MANDATORY Pre-commit Checks**
Before committing ANY code to the Omni MCP project, ensure ALL items are checked:

### âœ… **Shared Types Compliance**
- [ ] Uses shared types from `@mcp/schemas` package
- [ ] No duplicate type definitions across servers
- [ ] All tool returns use `McpResponse<T>` format
- [ ] Imports from package, not relative paths for shared code

### âœ… **MCP Server Requirements** (if adding/modifying servers)
- [ ] Implements all 3 MCP capabilities (tools, resources, prompts)
- [ ] Returns `McpResponse<T>` from all tools
- [ ] Includes proper error handling with structured responses
- [ ] Follows naming convention: `{service}_{action}` (snake_case)
- [ ] Has Dockerfile with health checks
- [ ] Extends from `tsconfig.base.json`

### âœ… **TypeScript Quality**
- [ ] Passes TypeScript strict checks (`tsc --noEmit`)
- [ ] No TypeScript errors or warnings
- [ ] Uses explicit return types for public functions
- [ ] Proper import/export patterns with `.js` extensions
- [ ] No use of `any` without justification and documentation

### âœ… **Code Quality Standards**
- [ ] Includes comprehensive error handling
- [ ] Uses Zod schemas for input validation
- [ ] Structured logging (no `console.log` in production code)
- [ ] Environment variables for all configuration
- [ ] No hardcoded secrets or credentials

### âœ… **Testing Requirements**
- [ ] Unit tests for new functionality
- [ ] Tests cover error cases and edge conditions
- [ ] Mock external API calls appropriately
- [ ] Integration tests for MCP server changes
- [ ] All tests pass locally

### âœ… **Documentation & Standards**
- [ ] Code is self-documenting with clear variable/function names
- [ ] Complex logic includes explanatory comments
- [ ] Public APIs have JSDoc comments
- [ ] README updated if adding new server or major features
- [ ] Follows established patterns in existing codebase

### âœ… **Performance & Security**
- [ ] No performance regressions in critical paths
- [ ] Input validation prevents injection attacks
- [ ] Secrets managed via environment variables
- [ ] No sensitive data in logs or error messages
- [ ] Dockerfile follows security best practices

## ğŸš« **Pre-commit Blockers**
The following issues MUST be resolved before committing:

### **Type System Violations**
- âŒ Custom response types instead of `McpResponse<T>`
- âŒ Skipped shared type imports from `@mcp/schemas`
- âŒ Use of `any` without documentation
- âŒ TypeScript strict mode errors

### **Architecture Violations**
- âŒ MCP servers without all 3 capabilities
- âŒ Business logic in the gateway
- âŒ Direct client-server connections bypassing gateway
- âŒ Duplicate type definitions across servers

### **Code Quality Issues**
- âŒ Unhandled exceptions or errors
- âŒ Missing input validation
- âŒ Console.log statements in production code
- âŒ Hardcoded configuration values
- âŒ Ignored linter errors

### **Testing Gaps**
- âŒ No tests for new functionality
- âŒ Failing tests
- âŒ Untested error paths
- âŒ Real API calls in unit tests

## ğŸ”§ **Quick Validation Commands**
Run these commands before committing:

```bash
# TypeScript compilation
pnpm type-check

# Linting
pnpm lint

# Tests
pnpm test

# Build check
pnpm build

# Shared schemas validation
cd shared/schemas && pnpm build
```

## ğŸ“ **Commit Message Standards**
Use conventional commit format:
```
feat: add linear issue creation tool
fix: resolve schema validation error
docs: update MCP server setup guide
refactor: extract shared error handling utility
test: add integration tests for gateway routing
```

## ğŸ¯ **Reviewer Checklist**
When reviewing PRs, verify:
- [ ] All pre-commit checks completed
- [ ] Code follows established patterns
- [ ] No architectural violations
- [ ] Adequate test coverage
- [ ] Clear commit messages
- [ ] No breaking changes without migration plan

## ğŸš€ **Success Criteria**
A successful commit should:
- âœ… **Build successfully** in CI/CD
- âœ… **Pass all tests** including integration
- âœ… **Follow type system** requirements
- âœ… **Maintain code quality** standards
- âœ… **Include proper documentation**
- âœ… **Be ready for production** deployment

Remember: **Quality over speed** - taking time for these checks prevents bugs and technical debt!
