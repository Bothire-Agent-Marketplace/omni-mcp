---
description: 
globs: 
alwaysApply: false
---
# MCP Server Development Rules

## ğŸ—ï¸ **MANDATORY Server Structure**
Each MCP server MUST follow this exact structure:
```
servers/{service-name}/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                # Entry point
â”‚   â”œâ”€â”€ config/                 # Configuration management
â”‚   â”œâ”€â”€ mcp-server/
â”‚   â”‚   â”œâ”€â”€ server.ts           # MCP server setup
â”‚   â”‚   â”œâ”€â”€ tools.ts            # Tool schemas (import from shared)
â”‚   â”‚   â”œâ”€â”€ resources.ts        # Resource definitions (import from shared)
â”‚   â”‚   â”œâ”€â”€ prompts.ts          # Prompt templates (import from shared)
â”‚   â”‚   â””â”€â”€ tools/
â”‚   â”‚       â””â”€â”€ {service}-tools.ts  # Tool implementations
â”œâ”€â”€ Dockerfile                  # Container definition
â”œâ”€â”€ package.json               # Dependencies
â””â”€â”€ tsconfig.json              # TypeScript config extending tsconfig.base.json
```

## âœ… **MANDATORY Implementation Requirements**
- **ALL servers MUST implement 3 capabilities**: Tools, Resources, Prompts
- **Use MCP SDK correctly** with proper request handlers
- **Follow hub-and-spoke architecture** via gateway
- **Single responsibility** - one external service per server

```typescript
// âœ… CORRECT - Complete MCP server setup
const server = new Server(
  { name: "service-mcp-server", version: "1.0.0" },
  { capabilities: { tools: {}, resources: {}, prompts: {} } }
);
```

## ğŸ”§ **Tool Implementation Patterns**
```typescript
// âœ… CORRECT tool implementation
import { McpResponse, SearchIssuesArgs } from "@mcp/schemas";

async linear_search_issues(args: SearchIssuesArgs): Promise<McpResponse<SearchResult>> {
  try {
    const data = await this.client.issues(args);
    return { success: true, data };
  } catch (error) {
    return { success: false, error: error.message };
  }
}
```

## ğŸ“‹ **Response Format (MANDATORY)**
ALL tool responses MUST use this exact format:
```typescript
// âœ… Success response
{ success: true, data: T, timestamp?: string, executionTime?: number }

// âœ… Error response  
{ success: false, error: string, timestamp?: string, executionTime?: number }
```

## ğŸ”§ **Configuration Patterns**
- Use environment variables for all secrets
- Extend from `tsconfig.base.json`
- Include health checks in Dockerfile
- Use exact versions for MCP SDK dependencies

## ğŸš« **Server Anti-Patterns**
- âŒ Don't create servers without all 3 MCP capabilities
- âŒ Don't put business logic in the gateway
- âŒ Don't use console.log in production (use structured logging)
- âŒ Don't skip input validation with Zod schemas
